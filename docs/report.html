<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8" />
	<title>Leeds Digital Festival Report</title>
	<link rel="StyleSheet" href="https://use.typekit.net/inj1tmf.css" type="text/css" />
	<style>
	/*! minireset.css v0.0.6A | MIT License | github.com/jgthms/minireset.css */html,body,p,ol,ul,li,dl,dt,dd,blockquote,figure,fieldset,legend,textarea,pre,iframe,hr,h1,h2,h3,h4,h5,h6{margin:0;padding:0}ul{list-style:none}button,input,select{margin:0}html{box-sizing:border-box}*,*::before,*::after{box-sizing:inherit}img,video{height:auto;max-width:100%}iframe{border:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}
	body { font-family: Arial; background-color: white; font-size: 16px; }
	.holder { max-width: 1080px; padding: 2em; margin: auto; }
	h1 { font-family:"brandon-grotesque"; }
	h1 + * { margin-top: 1em; }
	
	.panels { list-style: none; margin-left: 0; display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); grid-gap: 1em; }
	.panels > li { padding: 1em; background: #0C0C33;color:white; text-align:center; margin-bottom: 0; }
	.panels > li > * { line-height: 1.2em; }
	.panels > li > span { display: block; }
	.title { font-size: 1.2em; font-weight: bold; font-family:"brandon-grotesque"; }
	.number { font-size: 3em; font-weight: bold; font-family:"brandon-grotesque"; }
	
	
	</style>
	<script>
	/**
	  Leeds Digital Festival Reporting tool
	  (c) Open Innovations 2021
	*/
	(function(root){
		var OI = root.OI || {};
		OI.ready = function(fn){ if(document.readyState != 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn); };

		function Report(el,opts){
			if(!opts) opts = {};
			var data = opts.data||{};
			if(!data.host) data.host = {"file":"../data/2021-09/host-returns.json"};
			if(!data.UK) data.UK = {"file":"UK.svg"};
			if(!el){
				console.warn('No element to attach report to');
				return true;
			}
			this.update = function(){
				var i,panels,a,t,html;
				panels = [];
				var counts = {};
				var regions = {
					'North East':'UKC',
					'North West':'UKD',
					'Yorkshire and the Humber':'UKE',
					'Yorkshire and The Humber':'UKE',
					'East Midlands':'UKF',
					'West Midlands':'UKG',
					'East of England':'UKH',
					'London':'UKI',
					'South East':'UKJ',
					'South West':'UKK',
					'Wales':'UKL',
					'Scotland':'UKM',
					'Northern Ireland':'UKN'
				};
				if(data.host.json){
					panels.push('<li><span class="title">Host returns</span><span class="number">'+data.host.json.total_returns.toLocaleString()+'</span></li>');
					panels.push('<li><span class="title">First time host</span><span class="number">'+data.host.json.first_time_ldf_host.toLocaleString()+'</span></li>');
					if(data.host.json.registered){
						t = 0;
						for(i = 0; i < data.host.json.registered.length; i++) t += data.host.json.registered[i];
						panels.push('<li><span class="title">Registered</span><span class="number">'+t.toLocaleString()+'</span></li>');
					}
					if(data.host.json.attended){
						a = 0;
						for(i = 0; i < data.host.json.attended.length; i++) a += data.host.json.attended[i];
						panels.push('<li><span class="title">Attended</span><span class="number">'+a.toLocaleString()+'</span></li>');
					}
					if(data.host.json.uk_region_attendees && data.UK.text){
						// Work out region sums
						for(r in regions) counts[regions[r]] = 0;
						for(i = 0; i < data.host.json.uk_region_attendees.length; i++){
							r = regions[data.host.json.uk_region_attendees[i]];
							if(r) counts[r]++;
						}
						panels.push('<li style="grid-row: auto / span 2;"><span class="title">UK region attendees</span>'+data.UK.text.replace(/<svg/,'<svg id="UK-map" style="max-width:100%;height:auto;" ')+'</li>');
					}
				}
				html = '';
				html += '<ul class="panels">';
				for(i = 0; i < panels.length; i++) html += panels[i];
				html += '</ul>';
				
				if(el) el.innerHTML = html;

				var svg = el.querySelector('#UK-map');
				if(svg){
					// Update the UK map region colours
					var max = 0;
					for(r in counts) max = Math.max(max,counts[r]);
					for(r in counts){
						path = svg.querySelector('#'+r);
						region = "";
						for(rg in regions){
							if(regions[rg] == r) region = rg;
						}
						if(path){
							path.setAttribute('fill','rgba(61, 242, 186,'+(counts[r]/max)+')');
							path.innerHTML = "";
							title = document.createElementNS('http://www.w3.org/2000/svg','title');
							title.innerHTML = counts[r]+' responses for '+region;
							path.appendChild(title);
						}
					}
				}
			};

			// Get the data
			fetch(data.host.file,{cache: "no-cache"}).then(response => { return response.json(); }).then(json => {
				data.host.json = json;
				console.log(json);
				this.update();
				return true;
			});	
			// Get the data
			fetch(data.UK.file,{cache: "no-cache"}).then(response => { return response.text(); }).then(text => {
				data.UK.text = text;
				this.update();
				return true;
			});	
			return this;
		}
		OI.report = Report;
		root.OI = OI;
	})(window || this);
	</script>
</head>
<body>
	<div class="holder">
		<h1>Leeds Digital Festival Report</h1>
		<div id="report-area">
		
		</div>
	</div>
	<script>
		OI.ready(function(){
			report = new OI.report(document.getElementById('report-area'));
		});

	</script>

</body>
</html>